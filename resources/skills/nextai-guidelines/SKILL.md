# NextAI Usage Guidelines

Use when working with NextAI — provides essential knowledge about CLI architecture, directory structure, auto-managed files, and proper usage patterns.

## Purpose

Prevent common mistakes by understanding how NextAI works:
- NextAI is a global npm package, not local scripts
- Clear separation between user content and system state
- Auto-managed files that should never be edited manually
- Relationship between slash commands and CLI commands
- Support for both Claude Code and OpenCode AI clients

## CLI Architecture

### Global Command, Not Local Scripts

NextAI is installed globally via npm as `@frontztech/nextai-dev`:

```bash
npm install -g @frontztech/nextai-dev
```

The `nextai` command is ALWAYS global. It is NOT a local script in your project.

**DO NOT** try to run:
- `node .nextai/cli/nextai.mjs`
- `npm run nextai`
- `./nextai`

**ALWAYS** use:
- `nextai <command> [options]`

### Common CLI Commands

```bash
nextai init                           # Initialize NextAI in current project
nextai create "<title>" --type <type> # Create feature/bug/task
nextai list [--phase <phase>]         # List all tracked items
nextai show <id>                      # Display feature details
nextai status <id> [--block|--retry]  # Update feature status
nextai sync                           # Sync to AI client (.claude/ or .opencode/)
nextai remove <id>                    # Remove a feature
```

The CLI manages all state transitions, file creation, and synchronization automatically.

## Directory Structure

NextAI uses two main directories with distinct purposes:

### `nextai/` - User/AI Managed Content

This is WHERE YOU WORK. Contains active and archived features:

```
nextai/
├── todo/           # Active features, bugs, tasks
│   └── <id>/
│       ├── initialization.md
│       ├── planning/
│       ├── spec.md
│       └── tasks.md
├── done/           # Completed and archived features
│   └── <id>/
│       └── summary.md
├── docs/           # Project documentation (optional)
│   ├── product-overview.md
│   ├── architecture.md
│   ├── conventions.md
│   └── technical-guide.md
└── templates/      # Custom templates (optional)
```

### `.nextai/` - System Configuration & State

This is MANAGED BY THE CLI. Contains auto-generated configuration and state:

```
.nextai/
├── state/          # Feature state tracking (DO NOT EDIT)
│   ├── ledger.json
│   ├── session.json
│   └── history.log
├── metrics/        # Performance metrics (DO NOT EDIT)
│   ├── index.json
│   ├── aggregated.json
│   └── features/
├── config.json     # Project configuration (DO NOT EDIT)
├── profile.json    # User profile data (DO NOT EDIT)
├── templates/      # Synced from resources/templates/
├── skills/         # Synced from resources/skills/
└── agents/         # Synced from resources/agents/
```

**Key Principle:** Work in `nextai/`, let the CLI manage `.nextai/`

## Auto-Managed Files

These files are managed by the NextAI CLI. **DO NOT EDIT THEM MANUALLY:**

| File/Directory | Purpose | Why Not to Edit |
|---------------|---------|-----------------|
| `.nextai/state/ledger.json` | Tracks feature state, phases, metadata | Manual edits can corrupt state tracking |
| `.nextai/state/session.json` | Current session metadata | Managed by CLI session logic |
| `.nextai/state/history.log` | Audit log (JSONL format) | Append-only log, manual edits break integrity |
| `.nextai/metrics/*` | All metrics files and directories | Generated by CLI analytics |
| `.nextai/config.json` | Project-level configuration | Initialized by `nextai init` |
| `.nextai/profile.json` | User profile and preferences | Managed by CLI user settings |
| `.nextai/templates/` | Synced from `resources/templates/` | Overwritten on sync |
| `.nextai/skills/` | Synced from `resources/skills/` | Overwritten on sync |
| `.nextai/agents/` | Synced from `resources/agents/` | Overwritten on sync |

**If you need to modify configuration or state:**
1. Use the appropriate CLI command (e.g., `nextai status <id> --block`)
2. If no CLI command exists, ask the user or file an issue
3. NEVER manually edit state files as a workaround

## Slash Commands vs CLI Relationship

Your AI client provides slash commands that orchestrate workflows by invoking CLI commands internally.

### The Relationship

| Slash Command | CLI Command | Purpose |
|---------------|-------------|---------|
| `/nextai-create` | `nextai create` | Create new feature/bug/task with AI guidance |
| `/nextai-list` | `nextai list` | List all tracked items |
| `/nextai-show` | `nextai show <id>` | Display feature details |
| `/nextai-resume` | `nextai show <id>` | Resume work on a feature |
| `/nextai-status` | `nextai status <id>` | Update feature status |
| `/nextai-sync` | `nextai sync` | Sync resources to AI client |
| `/nextai-remove` | `nextai remove <id>` | Remove a feature |
| `/nextai-refine` | (workflow) | Product + technical refinement |
| `/nextai-implement` | (workflow) | Execute implementation tasks |
| `/nextai-review` | (workflow) | Code review process |
| `/nextai-testing` | (workflow) | Log manual testing results |
| `/nextai-complete` | (workflow) | Archive completed feature |

### Key Differences

**Slash Commands:**
- Orchestration prompts stored in `.claude/commands/` or `.opencode/command/`
- Provide AI guidance and workflow logic
- Invoke CLI commands internally
- Handle multi-step workflows
- Generated by `nextai sync`

**CLI Commands:**
- State management tools
- File system operations
- Phase transitions
- Data persistence
- Run directly in terminal

**Think of it this way:**
- CLI = The engine
- Slash commands = The steering wheel

## Common Pitfalls

| ✓ DO | ✗ DON'T |
|------|---------|
| Run `nextai show <id>` | Run `node .nextai/cli/nextai.mjs` |
| Use the global `nextai` command | Create or execute local CLI scripts |
| Let the CLI manage state files | Manually edit `ledger.json` or `session.json` |
| Understand `nextai/` vs `.nextai/` distinction | Confuse these two directories |
| Use slash commands for workflows | Skip CLI and modify state directly |
| Run `nextai sync` after resource changes | Expect changes to appear in AI client automatically |
| Work in `nextai/todo/<id>/` directories | Work directly in `.nextai/` directories |
| Check existing code in `nextai/done/` for patterns | Reinvent solutions from scratch |
| Use `nextai status <id> --block` for blockers | Edit state files to mark something blocked |
| Let auto-managed files be overwritten | Try to preserve manual edits in synced directories |

## Key Reminders

### Installation & Architecture
- NextAI is installed globally: `npm install -g @frontztech/nextai-dev`
- The `nextai` command is ALWAYS global, never local
- State management is the CLI's sole responsibility
- Slash commands orchestrate, CLI commands execute

### AI Client Support
- Both Claude Code and OpenCode are supported
- Slash commands work in both clients
- `nextai sync` generates client-specific integrations:
  - Claude: `.claude/commands/`, `.claude/skills/`
  - OpenCode: `.opencode/command/`, `.opencode/agent/`

### Directory Philosophy
- `nextai/` = Your workspace (features, docs, templates)
- `.nextai/` = CLI's workspace (state, config, synced resources)
- Resources live in npm package `resources/` directory
- Sync copies from `resources/` to `.nextai/` to `.claude/` or `.opencode/`

### State & Configuration
- Never manually edit files in `.nextai/state/`
- Never manually edit files in `.nextai/metrics/`
- Configuration changes go through CLI commands
- State corruption requires `nextai repair` or manual recovery

### Workflow Best Practices
- Use slash commands for guided workflows
- Use CLI commands for direct state queries
- Review completed features in `nextai/done/` for patterns
- Keep project docs in `nextai/docs/` for context
- Run `nextai sync` after modifying resources to update AI client

### When in Doubt
- Check `nextai --help` for available commands
- Use `nextai show <id>` to inspect feature state
- Review `.nextai/state/ledger.json` (read-only) for debugging
- Check `nextai/done/` for similar completed work
- Ask the user rather than guessing about state changes
